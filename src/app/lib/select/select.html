<div class="is-select">
  <div class="is-select__input is-select--shadow-box"
       [class.is-select__filter--shadow-box]="filterable"
       cdk-overlay-origin
       #selectOverlayOrigin="cdkOverlayOrigin"
       (click)="toggleOptionsBlock()">
    <div class="is-select__input-text">
      <i class="is-select__placeholder"
         *ngIf="!isSelectDisplayText && !selectedOptions?.length"> {{placeholder}} </i>

      <div [class.text-truncate]="!multiselect"
           *ngIf="!customInputContent">
        {{isSelectDisplayText}}
      </div>
      <div [hidden]="!isSelectDisplayText || !selectedOptions?.length">
        <div #isSelectInputContainer></div>
      </div>
    </div>
  </div>

  <ng-template #optionsContent>
    <ng-content></ng-content>
  </ng-template>

  <ng-template #selectOptions
               let-data="data">
    <div class="is-select__options is-select--shadow-box"
         *ngIf="data.isOpened"
         [ngClass]="[data.isOptionsPlacementClass, data.isSelectBackgroundTheme]"
         [@optionsAnimation]>
      <div class="is-select__filter-input"
           *ngIf="data.filterable">
        <i class="fa fa-search is-select__filter-input__icon"></i>
        <input class="is-select__filter-input__input"
               autofocus
               [(ngModel)]="data.isSelectFilterText"
               (input)="data.filterOptions()"
               (change)="data.preventChangeFromBubbling($event)"
               placeholder="{{data.filterPlaceholder}}"
               type="text">
        <i class="fa fa-times is-select__filter-input__icon
                      is-select__filter-input__icon-close"
           (click)="data.clearFilter()"
           *ngIf="data.isSelectFilterText">
        </i>
      </div>
      <ng-template [ngTemplateOutlet]="loadingTpl"></ng-template>
      <div class="d-block w-100 is-select__back-container"
           *ngIf="showBackButton()">
        <button class="is-select__back-button"
                (click)="goBack()">
          <i class="fa fa-arrow-left header-back__icon"></i> Back
        </button>
      </div>
      <div class="is-select__options-list"
           [class.is-custom-scroll]="!data.useMobileOptions"
           #optionList>
        <is-checkbox class="is-option"
                     *ngIf="data.allowSelectAll"
                     (change)="data.onSelectAll()"
                     [checked]="data.isSelectedAll">
          Select All
        </is-checkbox>
        <ng-container *ngIf="showOptionsBlock()">
          <ng-container *ngTemplateOutlet="optionsContent"></ng-container>
        </ng-container>
        <ng-container *ngIf="showNestedBlock()">
          <is-option #nestedOptions
                     *ngFor="let option of currentTreeData"
                     [value]="option.value"
                     [displayText]="option.displayText"
                     [associatedNode]="option"
                     [selected]="isNestedOptionSelected(option)">
          </is-option>
        </ng-container>
        <ng-container *ngIf="showEmptyMessageBlock()">
          <is-option class="is-option__unselectable"
                     [displayText]="emptyMessage">
          </is-option>
        </ng-container>
      </div>
    </div>
  </ng-template>

  <ng-template cdk-connected-overlay
               [cdkConnectedOverlayMinWidth]="triggerRect?.width"
               [cdkConnectedOverlayOpen]="isOpened && !useMobileOptions"
               [cdkConnectedOverlayOrigin]="selectOverlayOrigin"
               [cdkConnectedOverlayPositions]="connectedOverlayPositions"
               [cdkConnectedOverlayHasBackdrop]="hasBackdrop"
               [cdkConnectedOverlayBackdropClass]="isPortalBackgroundTheme"
               cdkConnectedOverlayPanelClass="is-select-overlay"
               [cdkConnectedOverlayScrollStrategy]="overlayScrollStrategy"
               (backdropClick)="toggleOptionsBlock(true)">
    <div class="is-select__options is-select--shadow-box"
         *ngIf="isOpened"
         [ngClass]="[isOptionsPlacementClass, isSelectBackgroundTheme]"
         [@optionsAnimation]>
      <div class="is-select__filter-input"
           *ngIf="filterable">
        <i class="fa fa-search is-select__filter-input__icon"></i>
        <input #filterInput
               class="is-select__filter-input__input"
               autofocus
               [(ngModel)]="isSelectFilterText"
               (ngModelChange)="onFilterChange()"
               (input)="filterOptions()"
               (change)="preventChangeFromBubbling($event)"
               [placeholder]="filterPlaceholder"
               type="text">
        <i class="fa fa-times is-select__filter-input__icon
                      is-select__filter-input__icon-close"
           (click)="clearFilter()"
           *ngIf="isSelectFilterText">
        </i>
      </div>

      <ng-template [ngTemplateOutlet]="loadingTpl"></ng-template>

      <div class="d-block w-100 is-select__back-container"
           *ngIf="showBackButton()">
        <button class="is-select__back-button"
                (click)="goBack()">
          <i class="fa fa-arrow-left header-back__icon"></i> Back
        </button>
      </div>
      <div class="is-select__options-list"
           [class.is-custom-scroll]="!useMobileOptions"
           #optionList>
        <is-checkbox class="is-option"
                     *ngIf="allowSelectAll"
                     (change)="onSelectAll()"
                     [checked]="isSelectedAll">
          Select All
        </is-checkbox>
        <ng-container *ngIf="showOptionsBlock()">
          <ng-container *ngTemplateOutlet="optionsContent"></ng-container>
        </ng-container>
        <ng-container *ngIf="showNestedBlock()">
          <is-option #nestedOptions
                     *ngFor="let option of currentTreeData"
                     [value]="option.value"
                     [displayText]="option.displayText"
                     [associatedNode]="option"
                     [selected]="option.selected">
          </is-option>
        </ng-container>
        <ng-container *ngIf="showEmptyMessageBlock()">
          <is-option class="is-option__unselectable"
                     [displayText]="emptyMessage">
          </is-option>
        </ng-container>
      </div>
    </div>
  </ng-template>
</div>


<ng-template #loadingTpl>
  <div class="is-select__loading w-100 my-2 text-center"
       *ngIf="loading">
    <i class="fas fa fa-spinner fa-pulse is-select__loading-spinner"></i>
    <div class="is-select__loading-message"
         *ngIf="loadingMessage">
      {{loadingMessage}}
    </div>
  </div>
</ng-template>