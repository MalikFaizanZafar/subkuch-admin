<div
  *ngIf="loading"
  class="col h-100 d-flex justify-content-center align-items-center loader-container"
>
  <div class="is-loader"></div>
  <h6 class="ml-2">Loading Orders</h6>
</div>
<div *ngIf="!loading">
<is-card>
  <is-card-header>
    <div class="d-flex w-100 justify-content-between align-items-center">
      <h4>Orders</h4>
      <button is-button (click)="createOrder()">Create Order</button>
    </div>
  </is-card-header>
  <is-card-content>

    <div *ngIf="loading" class="col min-content-height d-flex justify-content-center align-items-center loader-container">
      <div class="is-loader"></div>
    </div>
    <is-grid *ngIf="!loading" 
              class="my-3 border-dark" 
              [value]="orders" 
              [rowExpandMode]="'single'" 
              expandableRows="true" 
              selectionMode="single"
              [(selection)]="selectedItem2">
      <is-grid-column expander="true" [style]="{ width: '5px', height: '30px' }" styleClass="bg_blue">
      </is-grid-column>
      <is-grid-column field="orderNumber." header="Order #" styleClass="text-dark" [style]="{ width: '50px', height: '50px' }">
        <ng-template let-order="rowData" isGridTemplate="body">
          <span>{{ order.orderNumber }}</span>
        </ng-template>
      </is-grid-column>
      <is-grid-column
        [style]="{ width: '50px', height: '50px' }"
        field="delivery"
        header="Delivery"
        styleClass="text-dark">
        <ng-template let-order="rowData" isGridTemplate="body">
          <div class="d-flex justify-content-start">
            <is-checkbox [(ngModel)]="order.delivery" disabled></is-checkbox>
          </div>
        </ng-template>
      </is-grid-column>
      <is-grid-column
        field="status"
        header="Status"
        styleClass="text-dark"
        [style]="{ width: '50px', height: '50px' }">
        <ng-template let-order="rowData" isGridTemplate="body">
            <div ngbDropdown
            class="d-inline-block">
         <button is-button
                 [theme]="getTheme(order)"
                 id="dropdownBasic1"
                 ngbDropdownToggle
                 [disabled]="isActionDisabled(order)">
            {{getActionValue(order)}}
         </button>
         <div ngbDropdownMenu
              aria-labelledby="dropdownBasic1"
              class="dropdown-menu-right">
           <ng-container *ngFor="let menuItem of menuItems">
             <button class="dropdown-item" 
                     *ngIf="isVisibleItem(menuItem, order)"
                     (click)="menuAction(menuItem, order)">
               {{ menuItem.text }}
             </button>
           </ng-container>
         </div>
       </div>
        </ng-template>
      </is-grid-column>
      <ng-template let-data isGridTemplate="rowexpansion">
        <div>
        <div class="d-flex justify-content-between my-3 px-2">
          <div class="w-25" *ngIf="data.user">
            <div class="d-flex">
              <h5  class="mr-3">Name: </h5> <span>{{data.user.name}}</span>
            </div>
            <div class="d-flex" >
              <h5 class="mr-3">Email: </h5> <span>{{data.user.email}}</span>
            </div>
            <div class="d-flex" >
              <h5 class="mr-3">Contact: </h5> <span>{{data.user.phone}}</span>
            </div>
          </div>

          <div class="w-25">
            <div class="d-flex" *ngIf="data.location">
              <h5  class="mr-3">Location: </h5> <span>{{data.location}}</span>
            </div>
            <div class="d-flex" *ngIf="data.longitude && data.latitude">
              <h5 class="mr-3">Coordinates: </h5> <span>{{data.longitude}}, {{data.latitude}}</span>
            </div>
          </div>

          <div *ngIf="data.starttime">
            <div class="d-flex ">
              <h5 class="mr-3">Date: </h5> <span>{{data.starttime | date}}</span>
            </div>
            <div class="d-flex" >
              <h5 class="mr-3">Time: </h5> <span>{{data.starttime | date: 'shortTime'}}</span>
            </div>
          </div>
        </div>

          <h4 class="d-flex justify-content-center text-dark my-2" *ngIf="data.detail.length">
            Items/Deals
          </h4>
          <table is-table
                [data]="data.detail"
                *ngIf="data.detail.length">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Price</th>
                <th>Discount</th>
                <th>Quantity</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let detail of data.detail;  let i= index;">
                <td style="width: 30px; text-align: center;">
                  {{i + 1}}
                </td>
                <td *ngIf="detail.item == null">{{ detail.deal.name }}</td>
                <td *ngIf="detail.item == null">{{ detail.deal.price }}</td>
                <td *ngIf="detail.item == null">{{ detail.deal.discount }}</td>
                <td *ngIf="detail.item == null">{{ detail.quantity }}</td>
                
                <td *ngIf="detail.deal == null">{{ detail.item.name }}</td>
                <td *ngIf="detail.deal == null">{{ detail.item.price }}</td>
                <td *ngIf="detail.deal == null">{{ detail.item.discount }}</td>
                <td *ngIf="detail.deal == null">{{ detail.quantity }}</td>
                
              </tr>
            </tbody>
          </table>
          <div class="p-3">
            <div class="w-100 d-flex justify-content-end">
              <div class=" text-right" style="width: 150px;"><strong>Total: </strong></div>
              <div style="width: 150px;" class=" text-right" > {{data.total}}</div>
            </div>
            <div class="w-100 d-flex justify-content-end">
              <div class=" text-right" style="width: 150px;"><strong>Discount: </strong></div>
              <div style="width: 150px;" class=" text-right" > {{data.discount}}</div>
            </div>
            <div class="w-100 d-flex justify-content-end">
              <div class=" text-right" style="width: 150px;"><strong>Total Payable: </strong></div>
              <div style="width: 150px;" class=" text-right" > {{data.total - data.discount}}</div>
            </div>
          
          </div>
        </div>
      </ng-template>
    </is-grid>
  </is-card-content>
</is-card>
</div>